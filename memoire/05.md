# 5. Maintenance évolutive

> **Lecture jury — à retenir**
> - Objectif : livrer des évolutions en cycle en V (spécifications validées, réalisation, recette VA/VSR), sans régression.
> - Risques évités : dérives de besoin, changements non validés, régression en production, documentation non synchronisée.
> - Réponse du titulaire : analyse d'impact (SQL/HD), tests de non‑régression avant livraison, note de livraison + rollback.
> - Preuves : Annexe A.1 (note de livraison), Annexe A.2 (rapport tests), Annexe A.10 (cahier de recette).

## 5.1 Organisation générale des évolutions

### 5.1.1 Cadre de la maintenance évolutive

Notre approche de la maintenance évolutive s'inscrit dans le strict respect du périmètre fonctionnel et technique d'AQUAREEL. Conformément aux orientations du CCTP, nous nous engageons à concevoir et développer les évolutions dans la continuité de l'architecture existante, sans rupture technologique ni remise en cause des principes fondamentaux de l'application.

Les prestations de maintenance évolutive visent à répondre aux besoins métier exprimés par le service central Vigicrues et le SPC Grand Delta, en s'appuyant rigoureusement sur :

- Le modèle de données existant et ses évolutions strictement nécessaires
- Les principes de développement centrés sur le SGBD SQL Server
- La compatibilité totale avec l'architecture en haute disponibilité (réplication transactionnelle)
- Le maintien des performances dans la configuration matérielle décrite au CCTP
- La préservation des interfaces et protocoles de communication en place

### 5.1.2 Objectifs prioritaires identifiés

Le CCTP identifie comme orientation stratégique principale l'**abandon progressif du client Windows au profit du client léger**. Cette évolution majeure constitue le fil conducteur de la maintenance évolutive et sera menée dans un cadre méthodologique rigoureux, visant à :

- La continuité de service pendant toute la période de transition
- La compatibilité ascendante avec les installations existantes
- Éviter toute rupture pour les utilisateurs finaux
- La traçabilité complète des modifications apportées

Au-delà de cette orientation majeure, nous nous engageons à traiter l'ensemble des demandes d'évolution fonctionnelles et techniques exprimées par la maîtrise d'ouvrage, dans le respect scrupuleux des exigences et bonnes pratiques décrites au § 3.3 du CCTP.

## 5.2 Processus de développement : cycle en V rigoureux

### 5.2.1 Vue d'ensemble du processus

La maintenance évolutive s'appuie sur un **cycle en V** éprouvé, assurant la traçabilité, la validation et la qualité à chaque étape du développement. Ce processus, décrit au § 5 du CCTP, assure un alignement continu entre les attentes de la maîtrise d'ouvrage et les livrables produits.

Chaque lot d'évolutions fait l'objet d'un phasage unique en 4 étapes distinctes :

1. **Étape 1** : Spécifications générales fonctionnelles (rédigées par la maîtrise d'ouvrage)
2. **Étape 2** : Spécifications détaillées et conception (réalisées par le titulaire, soumises à validation)
3. **Étape 3** : Réalisation, tests de validation et livraison (développement, tests internes, documentation)
4. **Étape 4** : Recette (Vérification d'Aptitude et Vérification de Service Régulier)

Ce processus permet de valider chaque évolution techniquement et fonctionnellement avant sa mise en production, afin de minimiser les risques d'anomalies et de préserver la stabilité de l'application critique AQUAREEL.

### 5.2.2 Regroupement en lots et cadence de livraison

Conformément au CCTP, les évolutions seront regroupées en lots cohérents, avec une cadence estimée à **2 versions maximum par an**. Ce regroupement permet de :

- Mutualiser les phases de tests et de recette
- Réduire le nombre d'interventions sur les instances en production
- Optimiser la planification des ressources techniques et métier
- Faciliter la documentation et le suivi des versions

Chaque lot fera l'objet de bons de commande spécifiques pour les étapes 2, 3 et 4, avec des délais d'exécution définis dans les bons de commande.

## 5.3 Étape 2 : Spécifications détaillées et conception

### 5.3.1 Objectifs et livrables de l'étape 2

L'étape 2 constitue une phase déterminante du cycle de développement. À partir des spécifications générales fonctionnelles rédigées par la maîtrise d'ouvrage (étape 1), nous produirons un **dossier de spécifications fonctionnelles et techniques détaillées et de conception des évolutions**.

Conformément aux attentes du CCTP (§ 5.2), ce dossier aura un double objet :

1. **Traduction des exigences fonctionnelles** : formalisation détaillée de chaque fonction, écran, traitement, export, collecte, etc., en réponse au cahier des charges de la maîtrise d'ouvrage
2. **Description des solutions techniques** : choix d'architecture, impacts sur le modèle de données, procédures stockées, services applicatifs, interfaces clients

Ce dossier sera **soumis à l'approbation formelle de la maîtrise d'ouvrage** avant tout démarrage de développement (étape 3).

### 5.3.2 Jalons intermédiaires et validation progressive

Le CCTP souligne l'importance d'une validation progressive et itérative durant l'étape 2. Nous mettrons en œuvre des **jalons intermédiaires**, définis en début de phase, et organisés sous forme de **réunions techniques de présentation**.

Ces jalons permettront à la maîtrise d'ouvrage de vérifier et valider :

- La **compréhension du besoin fonctionnel**, des contraintes et exigences
- L'**adaptation des solutions techniques** vis-à-vis de l'existant
- La **cohérence des évolutions** avec les principes de développement d'AQUAREEL
- L'**impact sur le modèle de données** et sa compatibilité avec la réplication SQL Server

Un planning détaillé des jalons sera proposé au démarrage de chaque lot d'évolutions et soumis à la validation de la maîtrise d'ouvrage.

### 5.3.3 Analyse d'impact et préservation de l'architecture

Chaque évolution fera l'objet d'une **analyse d'impact détaillée** portant sur :

#### 5.3.3.1 Impact sur le modèle de données

Conformément au § 3.3.1 du CCTP, toute évolution du modèle de données respectera scrupuleusement :

- Le **formalisme MERISE** pour la modélisation conceptuelle et physique
- Les **règles de l'art** (notamment l'interdiction de réutilisation des identifiants SQL entre tables différentes, sauf clés étrangères)
- Les **normes de nommage** initialement élaborées (domaines, entités, associations, tables, vues, procédures, fonctions, déclencheurs)
- La **documentation du code** selon les standards en vigueur

Les évolutions du modèle conceptuel seront **systématiquement soumises à validation préalable** de la maîtrise d'ouvrage avant application des modifications et poursuite des développements.

#### 5.3.3.2 Impact sur la réplication SQL Server (haute disponibilité)

Une attention particulière sera portée à la **compatibilité avec la réplication transactionnelle SQL Server**, colonne vertébrale de l'architecture en haute disponibilité. Toute modification du modèle de données ou des traitements sera conçue pour préserver :

- Le bon fonctionnement de la **publication de réplication**
- La cohérence des données entre le site actif et les sites passifs
- La capacité à réinitialiser les abonnés en cas de besoin
- L'absence d'impact sur les performances de la réplication

Les scénarios de migration de données et de mise à jour de schéma seront décrits précisément, en tenant compte des contraintes de la réplication.

#### 5.3.3.3 Impact sur les services et modules applicatifs

L'analyse d'impact couvrira l'ensemble des composants de l'architecture orientée services (SOA) d'AQUAREEL :

- Service de collecte (radio, RTC, IP, LoRaWAN)
- Service d'échange (import/export)
- Service d'alarme et de supervision
- Service internet (SMS, collecte LoRaWAN)
- Frontal IP (serveur web IIS)
- Client Windows (client lourd)
- Client léger (application web)

Les **normes et conventions de nommage** ainsi que la **modélisation des composants** existants seront strictement respectées (CCTP § 3.3.3).

#### 5.3.3.4 Impact sur les performances

Conformément au § 2.2.5.2 du CCTP, nous veillerons à **optimiser les développements** pour contribuer au maintien des performances dans la configuration matérielle décrite (processeurs octo-cœur, 16 Go RAM, disques RAID 15 000 tr/min).

Si de nouveaux besoins fonctionnels nécessitaient une augmentation des ressources matérielles, la maîtrise d'ouvrage en serait informée **dès la phase de conception** (étape 2).

### 5.3.4 Chiffrage détaillé et estimation des charges

Le dossier de spécifications détaillées permettra également de **chiffrer de manière plus détaillée les développements à venir** (CCTP § 5.1), en décomposant les charges par :

- Développement des procédures stockées, vues, triggers (T-SQL)
- Développement des modules applicatifs (C#, .NET)
- Développement de l'interface cliente légère (JavaScript, Bootstrap, etc.)
- Tests unitaires et d'intégration
- Documentation technique et utilisateur
- Préparation des setup d'installation et de mise à jour

Ce chiffrage détaillé permettra à la maîtrise d'ouvrage de prendre une décision éclairée avant l'engagement de l'étape 3 (réalisation).

### 5.3.5 Exigences spécifiques pour les développements en base

Conformément au § 3.3.2 du CCTP, nous respecterons les axes forts de développement :

- **Utilisation dès que possible des fonctions applicatives du SGBDR** (procédures stockées, triggers, planificateur, etc.)
- **Optimisation des requêtes SQL** : compte tenu de la volumétrie importante (15 Go/an pour 200 stations) et des nécessités de temps de réponse optimal, un soin particulier sera accordé à l'élaboration des requêtes et au style de codage SQL
- **Interdiction du recours excessif aux fonctions scalaires** (standard et UDF) et aux curseurs
- **Recours systématique aux procédures stockées ou vues** pour toute opération d'UPDATE, DELETE ou INSERT par l'utilisateur SQL spécifique à l'application

Les développements réalisés en base seront **validés "au fil de l'eau"** par la maîtrise d'ouvrage durant les jalons intermédiaires.

## 5.4 Étape 3 : Réalisation, tests et livraison

### 5.4.1 Organisation de la phase de réalisation

L'étape 3 démarre après validation formelle du dossier de spécifications détaillées et signature du bon de commande correspondant. Elle comprend :

- Le **codage des évolutions** (base de données, services, clients)
- La réalisation des **tests unitaires** par module et composant
- Les **tests d'intégration** sur la plateforme de développement
- Les **tests de validation interne** sur la plateforme de test (configuration HD complète)
- La **mise à jour de la documentation** (technique, utilisateur, exploitation, installation)

Conformément au CCTP § 5.3, cette étape sera **interactive et itérative**, avec présentation régulière de résultats intermédiaires à la maîtrise d'ouvrage.

### 5.4.2 Stratégie de tests du titulaire

Le CCTP accorde une **importance particulière** aux tests réalisés par le titulaire, en soulignant que les tests de recette de la maîtrise d'ouvrage (étape 4) ne doivent **en aucun cas se substituer aux tests internes** du titulaire.

Notre stratégie de tests comprendra :

#### 5.4.2.1 Tests unitaires

- Tests de chaque procédure stockée, fonction, trigger
- Tests de chaque classe, méthode, service applicatif
- Vérification des entrées/sorties, des cas limites, des gestions d'erreurs
- Traçabilité dans des outils de tests automatisés (Visual Studio Test Framework, nUnit, xUnit)

#### 5.4.2.2 Tests d'intégration

- Tests des interactions entre modules (service de collecte / base de données, frontal IP / base tampon, etc.)
- Vérification des flux de données entre composants
- Tests de la compatibilité avec les interfaces existantes (modems, stations LNS et AQUACJ)

#### 5.4.2.3 Tests de validation avec interfaces externes réelles

Conformément au CCTP § 5.3, les tests devront **prendre en compte les interfaces externes réelles** :

- Modems RTC/GSM et radio
- Stations d'acquisition (1 station LNS et 1 station AQUACJ mises à disposition par la maîtrise d'ouvrage)
- Serveur LORAWAN (API SoM2M)
- Exports vers partages CIFS et FTP

Ces tests seront réalisés sur la **plateforme de test** configurée en haute disponibilité (2 sites de concentration + 1 site de surveillance).

#### 5.4.2.4 Tests de non-régression

Des **tests de non-régression** seront systématiquement menés afin de détecter d'éventuelles régressions sur les fonctionnalités existantes. Avant livraison, une campagne de tests de non‑régression, automatisée (base + applicatif) sur un jeu de données de référence et complétée si nécessaire par des contrôles manuels ciblés, est exécutée et fait l'objet d'un rapport de tests transmis à la maîtrise d'ouvrage (cf. Annexe A.2). Ces tests porteront sur :

- Les fonctions de collecte (radio, RTC, IP, LoRaWAN, import)
- Les fonctions d'exploitation (affinage, calculs, visualisation)
- Les fonctions d'échange (exports automatiques et manuels)
- Les fonctions d'alarme (hydrologiques, techniques, transmission)
- Les fonctions de supervision (haute disponibilité, réplication, bascule)

#### 5.4.2.5 Tests spécifiques à la haute disponibilité

Toute évolution impactant le modèle de données ou les traitements sera testée dans le contexte de la haute disponibilité :

- Vérification de la **compatibilité avec la réplication transactionnelle** SQL Server
- Tests de **bascule** entre site actif et site passif
- Vérification de la **reprise automatique en secours** (collecte IP, collecte LoRaWAN, exports)
- Vérification de la **supervision inter-sites**

#### 5.4.2.6 Tests radio sur la plateforme de Privas

Pour les évolutions concernant la collecte radio, la **plateforme de test de Privas (SPC GD)** sera mobilisée pour des tests de validation avant livraison à la maîtrise d'ouvrage. Cette plateforme, accessible à distance, permettra de valider le fonctionnement avec le réseau radio réel SCORPION 2.

### 5.4.3 Cahier de recette

Conformément au CCTP § 5.3, nous rédigerons un **cahier de recette** (cf. Annexe A.10) qui sera :

- Utilisé lors de nos **tests internes de validation** (étape 3)
- **Soumis à validation de la maîtrise d'ouvrage**
- **Utilisé par la maîtrise d'ouvrage** lors de la phase de recette (étape 4)

Ce cahier de recette comprendra :

- La description de chaque cas de test (objectif, prérequis, données d'entrée, actions, résultats attendus)
- Les procédures de vérification (fonctionnelles et techniques)
- Les critères de validation
- Les grilles de suivi de l'exécution des tests

Le cahier de recette couvrira l'ensemble des évolutions livrées et intégrera les tests de non-régression pertinents.

### 5.4.4 Recette "usine" (optionnelle)

À l'issue de la phase de réalisation, la maîtrise d'ouvrage (en lien avec le SPC Grand Delta) pourra réaliser une **recette "usine"**, à distance ou dans un environnement dédié convenu avec la maîtrise d'ouvrage (CCTP § 5.3). Cette recette, d'une durée d'**une journée maximum**, a pour objet de :

- Contrôler le **fonctionnement global** et la **complétude** des évolutions
- Valider le **passage en phase de recette VA** (étape 4)

Cette recette "usine" permettra de détecter en amont d'éventuels points de blocage et d'optimiser le déroulement de la phase de recette formelle.

### 5.4.5 Livrables de l'étape 3

À l'issue de l'étape 3, nous fournirons une **livraison complète** et une **livraison de mise à jour**, conformément au § 3.2 du CCTP.

Chaque livraison est accompagnée d'une note de livraison (cf. Annexe A.1) et d'un rapport de tests de non‑régression (cf. Annexe A.2). Ces deux documents constituent un prérequis : une livraison n'est pas transmise comme « prête à déployer » si la note de livraison, la procédure d'installation, la procédure de rollback ou le rapport de tests sont manquants.

#### 5.4.5.1 Livraison complète

La livraison complète comprendra :

- Un **document traçant l'ensemble des modifications** apportées par rapport à la version de référence
- Un **rapport de tests de non‑régression** (synthèse de la campagne exécutée, résultats et points de vigilance)
- Les **setup d'installation de l'application** (tous modules : SGBD, services, clients)
- Le **code source de l'application** (sources C#, T-SQL, JavaScript, fichiers de configuration)
- Un **document de description de la procédure d'installation**
- L'ensemble de la **documentation mise à jour** :
  - Manuel d'exploitation
  - Manuel utilisateur
  - Manuel d'installation
  - Modèle de données (MERISE, PowerAMC)
  - Documentation technique des développements (procédures stockées, services, API)

#### 5.4.5.2 Livraison de mise à jour

La livraison de mise à jour comprendra :

- Un **document traçant l'ensemble des modifications** apportées par rapport à la version de référence
- Un **rapport de tests de non‑régression** (synthèse de la campagne exécutée, résultats et points de vigilance)
- Les **setup d'installation des mises à jour** (patches applicatifs, scripts SQL)
- Un **document de description de la procédure d'installation de la mise à jour**
- La **documentation impactée mise à jour**
- La **mise à jour du code source** des composants concernés

#### 5.4.5.3 Documentation des procédures stockées

Conformément au CCTP § 3.3.2, les procédures stockées, fonctions et triggers développés seront **documentés** :

- Description fonctionnelle (objectif, contexte d'utilisation)
- Description technique (paramètres d'entrée/sortie, tables impactées, performances)
- Commentaires dans le code T-SQL

#### 5.4.5.4 Documentation des services

Conformément au CCTP § 3.3.3, les services développés ou modifiés seront documentés :

- Architecture du service (classes, composants, dépendances)
- Interfaces exposées (méthodes, API)
- Configuration (fichiers de configuration, paramètres)
- Procédures de déploiement et d'exploitation

### 5.4.6 Mise à disposition sur plateforme de développement et de test

Pendant toute la durée de l'étape 3, les évolutions seront développées sur notre **plateforme de développement** puis testées sur notre **plateforme de test** (configuration HD avec 2 sites de concentration et 1 site de surveillance).

Ces plateformes, mises en place lors de la phase d'initialisation (§ 4 du CCTP), fournissent un environnement de développement et de validation aligné sur les installations de production.

## 5.5 Étape 4 : Recette (VA et VSR)

### 5.5.1 Organisation de la recette

L'étape 4 comprend deux phases distinctes, conformément au CCTP § 5.4 :

1. **Vérification d'Aptitude (VA)** : réalisée par le SPC Grand Delta
2. **Vérification de Service Régulier (VSR)** : réalisée par des sites pilotes en SPC, en plus du SPC GD

La recette concerne le **logiciel et la documentation associée**.

### 5.5.2 Vérification d'Aptitude (VA)

La VA a pour objet de :

- Vérifier la **conformité du logiciel** au dossier de spécifications détaillées (étape 2)
- Vérifier que la **documentation est complète** et apte à remplir les fonctions attendues vis-à-vis des utilisateurs et des administrateurs

La VA est réalisée par le **SPC Grand Delta** sur la base du cahier de recette validé à l'étape 3.

### 5.5.3 Vérification de Service Régulier (VSR)

La VSR a pour objet de :

- Constater que le logiciel fourni est capable d'assurer un **service régulier** dans les conditions réelles d'exploitation
- Vérifier que la documentation répond aux besoins d'un **fonctionnement opérationnel**

La VSR est réalisée par des **sites pilotes en SPC**, en conditions réelles de production.

### 5.5.4 Critères de validation de la VSR

Conformément au CCTP § 5.4, pour valider la VSR, AQUAREEL devra **fonctionner en mode opérationnel pendant une durée minimum d'un mois** de manière continue **sans anomalie bloquante ni majeure**.

Cette exigence vise à assurer la stabilité et la fiabilité de l'application en conditions réelles, avant déploiement généralisé.

### 5.5.5 Gestion des anomalies détectées en recette

Les anomalies détectées en recette seront classées selon trois niveaux de gravité :

#### 5.5.5.1 Anomalies bloquantes

Une anomalie est considérée comme **bloquante** si elle empêche l'utilisation de l'application (exemples : absence de collecte, absence d'alimentation de la base nationale PHyC).

- Transmission **immédiate** par la maîtrise d'ouvrage
- Délai d'intervention : **2 jours ouvrés**
- Correction prioritaire et livraison de patch correctif

#### 5.5.5.2 Anomalies majeures

Une anomalie est considérée comme **majeure** si certaines fonctions importantes ne sont plus accessibles (exemple : la gestion des alarmes n'est plus opérationnelle).

- Transmission au fil de l'eau, regroupement en lot pour livraison de correction
- Délai d'intervention : selon planification validée avec la maîtrise d'ouvrage

#### 5.5.5.3 Anomalies mineures

Une anomalie est considérée comme **mineure** si l'application peut fonctionner malgré une fonction mineure impactée.

- Transmission au fil de l'eau, regroupement en lot pour livraison de correction
- Traitement dans le cadre des corrections mutualisées

### 5.5.6 Livrables de l'étape 4

À la fin de la recette, nous fournirons une **livraison complète** et une **livraison de mise à jour**, conformément au § 3.2 du CCTP, intégrant les corrections réalisées pendant les phases de recette.

La documentation sera mise à jour pour refléter toute évolution apportée suite aux corrections.

### 5.5.7 Validation de la recette

Les modalités de validation de la recette sont décrites au CCAP. La validation formelle de la recette (VA et VSR) conditionne le paiement des prestations et marque la mise en production généralisée de la version.

## 5.6 Traçabilité et suivi des évolutions

### 5.6.1 Gestion de configuration et versioning

Chaque lot d'évolutions fera l'objet d'une **gestion rigoureuse de la configuration** :

- Versioning du code source (Git, SVN ou équivalent)
- Identification claire des versions (numérotation sémantique)
- Traçabilité des modifications (commits, branches, tags)
- Documentation des changements entre versions

### 5.6.2 Suivi des bons de commande et jalons

Un tableau de bord de suivi sera mis à disposition de la maîtrise d'ouvrage, permettant de visualiser en temps réel :

- L'avancement de chaque lot d'évolutions (étape 2, 3, 4)
- Le respect des délais contractuels
- Les jalons de validation franchis ou à venir
- Les anomalies détectées et leur traitement

### 5.6.3 Communication et coordination

Une coordination étroite sera maintenue avec le service central Vigicrues et le SPC Grand Delta tout au long de la maintenance évolutive :

- Points d'étape réguliers (hebdomadaires ou bimensuels selon l'avancement)
- Réunions de jalons intermédiaires (étape 2)
- Présentation des résultats intermédiaires (étape 3)
- Réunions de recette (étape 4)
- Réunion annuelle de suivi (CCTP § 6)

## 5.7 Engagements du titulaire

Nous nous engageons formellement à :

1. **Respecter scrupuleusement le périmètre** défini dans les spécifications générales fonctionnelles et le CCTP
2. **Valider systématiquement** les choix techniques et les évolutions du modèle de données avec la maîtrise d'ouvrage
3. **Préserver la compatibilité** avec l'architecture en haute disponibilité (réplication SQL Server)
4. **Contribuer au maintien des performances** dans la configuration matérielle décrite au CCTP
5. **Documenter exhaustivement** les développements (base de données, services, interfaces)
6. **Réaliser des tests complets** (unitaires, intégration, validation, non-régression) avant toute livraison
7. **Livrer une documentation à jour** (technique, utilisateur, exploitation, installation)
8. **Respecter les normes et conventions** de développement d'AQUAREEL
9. **Assurer la traçabilité** des modifications et des versions
10. **Corriger les anomalies** détectées en recette dans les délais contractuels

Ces engagements visent à assurer la **fiabilité, la stabilité et la continuité de service** de l'application critique AQUAREEL, au service des missions de prévision des crues et de sécurité civile du réseau Vigicrues.
